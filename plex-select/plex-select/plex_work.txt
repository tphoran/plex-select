
Log Into Server
ssh -i "MyEC2KeyPair.pem" ubuntu@ec2-34-239-115-141.compute-1.amazonaws.com
ssh -i "MyEC2KeyPair.pem" ec2-user@ec2-52-90-35-51.compute-1.amazonaws.com
ssh -i "MyEC2KeyPair.pem" ec2-user@34.201.99.150

Boot Strap
#!/bin/bash
cd /home/ubuntu/
apt-get update
apt install awscli -y
apt install jq -y
aws s3 cp s3://manny-and-meche-plex/plex.sh plex.sh --region us-east-1
chmod +x plex.sh
bash plex.sh

#!/bin/bash
cd /home/ubuntu/
apt-get update
apt install awscli -y
apt install jq -y
aws s3 cp s3://manny-and-meche-plex/plex_wait.sh plex_wait.sh --region us-east-1
chmod +x plex_wait.sh
bash plex_wait.sh


Boot Strap V2
#!/bin/bash
sudo su
apt-get update
apt install awscli -y
aws s3 cp s3://manny-and-meche-plex/plex.sh plex.sh --region us-east-1
chmod +x plex.sh
bash plex.sh "Monty Python and the Holy Grail"


# Check Bootstrap Process
nano /var/log/cloud-init-output.log


10 Cloverfield Lane

pip install lambda-packages -t /Users/tphoran/github/plex-select/lambda-packages/

pip install imdbpy -t /Users/tphoran/github/plex-select/plea-select/lambda_upon_load/
aws s3 cp target/ s3://manny-and-meche-test --recursive
aws s3 cp --recursive s3://manny-and-meche-test /Users/tphoran/github/

aws s3 cp s3://manny-and-meche-test/lambda_function.py lambda_function.py --region us-east-1


# Miniconda3
aws s3 cp s3://manny-and-meche-plex/Miniconda3-latest-Linux-x86_64.sh Miniconda3-latest-Linux-x86_64.sh --region us-east-1
bash Miniconda3-latest-Linux-x86_64.sh -b -p /home/ubuntu/miniconda3
export PATH=/home/ubuntu//miniconda3/bin:$PATH
conda install selenium -y

# Google Chrome
aws s3 cp s3://manny-and-meche-plex/google-chrome-stable_current_amd64.deb google-chrome-stable_current_amd64.deb --region us-east-1 
apt-get install -y libappindicator1 fonts-liberation
dpkg --configure -a
dpkg -i google-chrome*.deb
apt-get -f install -y
dpkg -i google-chrome*.deb


# Plex Media Server
aws s3 cp s3://manny-and-meche-plex/plexmediaserver_1.13.9.5439-7303bc002_amd64.deb plexmediaserver_1.13.9.5439-7303bc002_amd64.deb --region us-east-1
dpkg -i plexmediaserver*.deb
systemctl enable plexmediaserver.service
systemctl start plexmediaserver.service

# Chromedriver
cd /home/ubuntu/miniconda3/bin/
aws s3 cp s3://manny-and-meche-plex/chromedriver chromedriver --region us-east-1
chown root:root chromedriver
chmod +x chromedriver

# Media File
mkdir -p /var/lib/plexmediaserver/Movies
cd /var/lib/plexmediaserver/Movies
aws s3 cp "s3://manny-and-meche-plex/Movies/Monty Python and the Holy Grail.m4v" "Monty Python and the Holy Grail.m4v"

# Python File
cd /home/ubuntu/
aws s3 cp s3://manny-and-meche-plex/plex_setup.py plex_setup.py --region us-east-1
python plex_setup.py












systemctl enable plexmediaserver.service
systemctl start plexmediaserver.service
mkdir -p /root/plex/movie
cd /root/plex/movie
aws s3 cp s3://manny-and-meche-plex/Thunderball.m4v Thunderball.m4v
apt-get install -y unzip xvfb libxi6 libgconf-2-4
apt-get install default-jdk -y

aws s3 cp s3://manny-and-meche-plex/google-chrome-stable_current_amd64.deb google-chrome-stable_current_amd64.deb
dpkg -i google-chrome*.deb

aws s3 cp s3://manny-and-meche-plex/chromedriver chromedriver
mv chromedriver /usr/bin/chromedriver
chown root:root /usr/bin/chromedriver
chmod +x /usr/bin/chromedriver




SSH Tunnel Into Server
ssh -N -L 8887:127.0.0.1:32400 -i "MyEC2KeyPair.pem" ubuntu@ec2-18-212-147-121.compute-1.amazonaws.com
http://18.212.147.121:32400/web/index.html

Helpful sites:
https://tecadmin.net/setup-selenium-chromedriver-on-ubuntu/


INSTANCE_ID=$(curl http://169.254.169.254/latest/meta-data/instance-id)  
aws ec2 describe-tags --filters "Name=resource-id,Values=$INSTANCE_ID" --region us-east-1 
MOVIE=$(aws ec2 describe-tags --filters "Name=resource-id,Values=$INSTANCE_ID" --region us-east-1 | jq '.["Tags"][0]["Value"]' | tr -d '"')


aws ec2 run-instances --launch-template LaunchTemplateId=lt-05717a43f72369345,Version=1 --tag-specifications "ResourceType=instance,Tags=[{Key=Name,Value=10 Cloverfield Lane}]"

import subprocess
command = ["./aws", "s3", "sync", "--acl", "public-read", "--delete",
           source_dir + "/", "s3://" + to_bucket + "/"]
print(subprocess.check_output(command, stderr=subprocess.STDOUT))

aws s3 sync --delete --acl public-read LOCALDIR/ s3://BUCKET/


command = ["./aws", "ec2", "run-instances", "--launch-template", "LaunchTemplateId=lt-05717a43f72369345,Version=1"]
print(subprocess.check_output(command, stderr=subprocess.STDOUT))


aws sts decode-authorization-message --encoded-message i5z0guucnaQIomFmsZ8IKj0vv6vTpyX7l6U1FlwZ9V4mw7BBsPErPS4g0nDf9wBJ4v9hnoSAtKyyliDbEg5hccPIyTKTJgaZdx7lJlJkL00Qno5R5A5deQx_Z7MkCgrRTdqVXRkrA0qFzbYPV9K3FTEILMxubZ_v5JvvUamrshGzMVTmsVvi7b4Cd605-nqHUvSCz9KtBJwIYNaipyXFkJDr9v9wghoU_C4zNHmjIluC7zALk5V4LL33_WWC6sCImo3vzT13Us21lZoBylWpoeJ0c5-gVtNvb0b4vnefOVzHl50Mkzm5MBQgVeAmSPpocKuzv6i4xWGqPPpNpt1QmAU4qE8wsGpuWQhimqk8xQVlyebVrvvifoLekOpL3V-rkNt4RgywS_AC7vF4av-3LwtOh0WoK6OuB0MuMAfUpWikHpqhD-JUT25Mld91dKScD2HYx0bcw5eWGYfioGtovyzR2vKShkFzOVYbx0CUcSjPp38t5b34gQgDv_VDPSYPpqLTckfbLOmDFAABeQCaa016dg


{u'Records': [{u'EventVersion': u'1.0', 
		u'EventSubscriptionArn': u'arn:aws:sns:us-east-1:253505115255:plex-request:b0494b6c-75b3-4d5d-aca7-7fd62401fc06', 
		u'EventSource': u'aws:sns', 
		u'Sns': {u'SignatureVersion': u'1', u'Timestamp': u'2018-10-26T11:49:49.020Z', u'Signature': u'BQe5Lcm6BGBuJdbmdtwp3NWQ1vsKZ8qB42xo9e5o1GfCFVPhLxTQNXC9Py+gx35cOjnKHlrq6Jc5z69GHo7EhqtbA2ntJ+SrI4+TkuDHzOMCXKvZEh5mKyS8XW+oh2JHsF34pp++MBeEWVDt2aYn/X41PtC4s5J/AUIk/7+4hkSTPwVO9ErBF7AB0yDAmBYXlqG6UIjfugEIa7o3hIQcedtn0rHldYBUpW9CCIU6CczwdibDSC+xg2dbBDcXiUthHFjmUZPnb1VEWzBXGSuvVMdLIQS3ILYi3J6qRhH2P8KiMfGIRRkyq7mS3bCb1KIaL7Y2BGjdzFR9sJcVjwp72g==', u'SigningCertUrl': u'https://sns.us-east-1.amazonaws.com/SimpleNotificationService-ac565b8b1a6c5d002d285f9598aa1d9b.pem', u'MessageId': u'e05df56b-5acd-51bc-8e61-a1265b50c901', u'Message': u'10 Cloverfield Lane', u'MessageAttributes': {}, u'Type': u'Notification', u'UnsubscribeUrl': u'https://sns.us-east-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:us-east-1:253505115255:plex-request:b0494b6c-75b3-4d5d-aca7-7fd62401fc06', u'TopicArn': u'arn:aws:sns:us-east-1:253505115255:plex-request', u'Subject': u'Request'}}]}




curl -X POST -d '{"text":"test"}'  https://vj4lj9885e.execute-api.us-east-1.amazonaws.com/prod

curl -X POST -H 'Content-type: application/json' --data '{"text":"Hello, World!"}' https://hooks.slack.com/services/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


curl -X POST https://vj4lj9885e.execute-api.us-east-1.amazonaws.com/prod


curl -H "Content-Type: application/x-www-form-encoded-urlencoded" -X POST -d '{"text":"mytext"}' https://ujuh8acm5f.execute-api.us-east-1.amazonaws.com/prod
